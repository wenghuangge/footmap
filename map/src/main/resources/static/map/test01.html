
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>足迹地图</title>
    <meta charset="utf-8">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <script type="text/javascript" src="/js/bmap.js"></script>
    <script type="text/javascript" src="/js/china.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=SetfMX0ek0HtPZ1ZmaQrTNar677GbDGA"></script>
    <script type="text/javascript" src="/js/jquery-3.5.1.min.js"></script>
    <script src="/js/angular.min.js"></script>
    <script src="/js/controller/mapController.js"></script>
    <link rel="stylesheet"  href="/css/map.css">


    <!--ace模板-->
    <link rel="stylesheet" href="/ace/assets/css/ace-skins.min.css" />
    <link rel="stylesheet" href="/ace/assets/css/ace-rtl.min.css" />
    <script src="/ace/assets/js/ace-extra.min.js"></script>
    <script src="/ace/assets/js/html5shiv.min.js"></script>
    <script src="/ace/assets/js/respond.min.js"></script>
    <link rel="stylesheet" href="/ace/assets/css/ace.min.css" class="ace-main-stylesheet" id="main-ace-style" />
    <link rel="stylesheet" href="/ace/assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/ace/assets/font-awesome/4.5.0/css/font-awesome.min.css" />

</head>
<body ng-app="myMap">
<body class="no-skin">
<!---->
<div id="navbar" class="navbar navbar-default          ace-save-state">
    <div class="navbar-container ace-save-state" id="navbar-container">
        <button type="button" class="navbar-toggle menu-toggler pull-left" id="menu-toggler" data-target="#sidebar">
            <span class="sr-only">Toggle sidebar</span>

            <span class="icon-bar"></span>

            <span class="icon-bar"></span>

            <span class="icon-bar"></span>
        </button>

        <div class="navbar-header pull-left">
            <a href="test01.html" class="navbar-brand">
                <small>
                    <i class="fa fa-leaf"></i>
                    首页
                </small>
            </a>
            <a href="test01.html" class="navbar-brand">
                <small>
                    足迹
                </small>
            </a>
            <a href="test01.html" class="navbar-brand">
                <small>
                    发布足迹
                </small>
            </a>
            <a href="test01.html" class="navbar-brand">
                <small>
                    我的故事
                </small>
            </a>
        </div>

        <div class="navbar-buttons navbar-header pull-right" role="navigation">
            <ul class="nav ace-nav">

                <li class="light-blue dropdown-modal">
                    <a data-toggle="dropdown" href="#" class="dropdown-toggle">
                        <img class="nav-user-photo" src="/ace/assets/images/avatars/user.jpg" alt="Jason's Photo" />
                        <span class="user-info">
									<small>Welcome,</small>
									Jason
								</span>

                        <i class="ace-icon fa fa-caret-down"></i>
                    </a>

                    <ul class="user-menu dropdown-menu-right dropdown-menu dropdown-yellow dropdown-caret dropdown-close">
                        <li>
                            <a href="#">
                                <i class="ace-icon fa fa-cog"></i>
                                Settings
                            </a>
                        </li>

                        <li class="divider"></li>

                        <li>
                            <a href="#">
                                <i class="ace-icon fa fa-power-off"></i>
                                Logout
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div><!-- /.navbar-container -->
</div>


</div><!-- /.main-container -->
<div class="clean"></div>
<!--head end-->
<div id="container"></div>
<div id="right" ng-controller="photoCtr">
    <h1>{{cityname}}</h1>
    <div class="clean"></div>
    <div class="each" ng-repeat="item in photos">
        <h2 class="title">{{ item.title }}</h2>
        <div class="img-area">
            <div ng-repeat="img in item.imgList track by $index" >
                <img src="{{img}}" class="img-each">
            </div>
        </div>

        <div class="clean"></div>
        <div class="bottom-content">
            <div class="address">{{ item.address }}</div>
            <div class="bottom">
                <view class="time">{{item.stime}}</view>
                <button class="detail" ng-click="detail(item.id)" data-storyid="{{ item.id }}" >详情</button>
                <button class="delete"  data-pointId="{{ item.id }}">删除</button>
            </div>
        </div>
    </div>
</div>
<script>
    var photos;
    $.ajax({
       type:"GET",
       url:"/map/map",
       datatype:"json",
       async:false,
       success:function (data){
           photos=data;
       }
    });

</script>
<script type="text/javascript">
    var BJData=[];
    for(var i=0;i<photos.length;i++){
        var temp=[];
        var a={},b={};
        a['name']="温州市";
        b['name']=photos[i].city;
        b['value']=80;
        temp.push(a);
        temp.push(b);
        BJData.push(temp);
    }
    console.log(BJData);
    var migrationMapChart = echarts.init(document.getElementById('container'));
    //离开北京的数据
    var geoCoordMap = {
        '海门市':[121.15,31.89],
        '鄂尔多斯市':[109.781327,39.608266],
        '招远市':[120.38,37.35],
        '舟山市':[122.207216,29.985295],
        '齐齐哈尔市':[123.97,47.33],
        '盐城市':[120.13,33.38],
        '赤峰市':[118.87,42.28],
        '青岛市':[120.33,36.07],
        '乳山市':[121.52,36.89],
        '金昌市':[102.188043,38.520089],
        '泉州市':[118.58,24.93],
        '莱西市':[120.53,36.86],
        '日照市':[119.46,35.42],
        '胶南市':[119.97,35.88],
        '南通市':[121.05,32.08],
        '拉萨市':[91.11,29.97],
        '云浮市':[112.02,22.93],
        '梅州市':[116.1,24.55],
        '文登市':[122.05,37.2],
        '上海市':[121.48,31.22],
        '攀枝花市':[101.718637,26.582347],
        '威海市':[122.1,37.5],
        '承德市':[117.93,40.97],
        '厦门市':[118.1,24.46],
        '汕尾市':[115.375279,22.786211],
        '潮州市':[116.63,23.68],
        '丹东市':[124.37,40.13],
        '太仓市':[121.1,31.45],
        '曲靖市':[103.79,25.51],
        '烟台市':[121.39,37.52],
        '福州市':[119.3,26.08],
        '瓦房店市':[121.979603,39.627114],
        '即墨市':[120.45,36.38],
        '抚顺市':[123.97,41.97],
        '玉溪市':[102.52,24.35],
        '张家口市':[114.87,40.82],
        '阳泉市':[113.57,37.85],
        '莱州市':[119.942327,37.177017],
        '湖州市':[120.1,30.86],
        '汕头市':[116.69,23.39],
        '昆山市':[120.95,31.39],
        '宁波市':[121.56,29.86],
        '湛江市':[110.359377,21.270708],
        '揭阳市':[116.35,23.55],
        '荣成市':[122.41,37.16],
        '连云港市':[119.16,34.59],
        '葫芦岛市':[120.836932,40.711052],
        '常熟市':[120.74,31.64],
        '东莞市':[113.75,23.04],
        '河源市':[114.68,23.73],
        '淮安市':[119.15,33.5],
        '泰州市':[119.9,32.49],
        '南宁市':[108.33,22.84],
        '营口市':[122.18,40.65],
        '惠州市':[114.4,23.09],
        '江阴市':[120.26,31.91],
        '蓬莱市':[120.75,37.8],
        '韶关市':[113.62,24.84],
        '嘉峪关市':[98.289152,39.77313],
        '广州市':[113.23,23.16],
        '延安市':[109.47,36.6],
        '太原市':[112.53,37.87],
        '清远市':[113.01,23.7],
        '中山市':[113.38,22.52],
        '昆明市':[102.73,25.04],
        '寿光市':[118.73,36.86],
        '盘锦市':[122.070714,41.119997],
        '长治市':[113.08,36.18],
        '深圳市':[114.07,22.62],
        '珠海市':[113.52,22.3],
        '宿迁市':[118.3,33.96],
        '咸阳市':[108.72,34.36],
        '铜川市':[109.11,35.09],
        '平度市':[119.97,36.77],
        '佛山市':[113.11,23.05],
        '海口市':[110.35,20.02],
        '江门市':[113.06,22.61],
        '章丘市':[117.53,36.72],
        '肇庆市':[112.44,23.05],
        '大连市':[121.62,38.92],
        '临汾市':[111.5,36.08],
        '吴江市':[120.63,31.16],
        '石嘴山市':[106.39,39.04],
        '沈阳市':[123.38,41.8],
        '苏州市':[120.62,31.32],
        '茂名市':[110.88,21.68],
        '嘉兴市':[120.76,30.77],
        '长春市':[125.35,43.88],
        '胶州市':[120.03336,36.264622],
        '银川市':[106.27,38.47],
        '张家港市':[120.555821,31.875428],
        '三门峡市':[111.19,34.76],
        '锦州市':[121.15,41.13],
        '南昌市':[115.89,28.68],
        '柳州市':[109.4,24.33],
        '三亚市':[109.511909,18.252847],
        '自贡市':[104.778442,29.33903],
        '吉林市':[126.57,43.87],
        '阳江市':[111.95,21.85],
        '泸州市':[105.39,28.91],
        '西宁市':[101.74,36.56],
        '宜宾市':[104.56,29.77],
        '呼和浩特市':[111.65,40.82],
        '成都市':[104.06,30.67],
        '大同市':[113.3,40.12],
        '镇江市':[119.44,32.2],
        '桂林市':[110.28,25.29],
        '张家界市':[110.479191,29.117096],
        '宜兴市':[119.82,31.36],
        '北海市':[109.12,21.49],
        '西安市':[108.95,34.27],
        '金坛市':[119.56,31.74],
        '东营市':[118.49,37.46],
        '牡丹江市':[129.58,44.6],
        '遵义市':[106.9,27.7],
        '绍兴市':[120.58,30.01],
        '扬州市':[119.42,32.39],
        '常州市':[119.95,31.79],
        '潍坊市':[119.1,36.62],
        '重庆市':[106.54,29.59],
        '台州市':[121.420757,28.656386],
        '南京市':[118.78,32.04],
        '滨州市':[118.03,37.36],
        '贵阳市':[106.71,26.57],
        '无锡市':[120.29,31.59],
        '本溪市':[123.73,41.3],
        '克拉玛依市':[84.77,45.59],
        '渭南市':[109.5,34.52],
        '马鞍山市':[118.48,31.56],
        '宝鸡市':[107.15,34.38],
        '焦作市':[113.21,35.24],
        '句容市':[119.16,31.95],
        '北京市':[116.46,39.92],
        '徐州市':[117.2,34.26],
        '衡水市':[115.72,37.72],
        '包头市':[110,40.58],
        '绵阳市':[104.73,31.48],
        '乌鲁木齐市':[87.68,43.77],
        '枣庄市':[117.57,34.86],
        '杭州市':[120.19,30.26],
        '淄博市':[118.05,36.78],
        '鞍山市':[122.85,41.12],
        '溧阳市':[119.48,31.43],
        '库尔勒市':[86.06,41.68],
        '安阳市':[114.35,36.1],
        '开封市':[114.35,34.79],
        '济南市':[117,36.65],
        '德阳市':[104.37,31.13],
        '温州市':[120.65,28.01],
        '九江市':[115.97,29.71],
        '邯郸市':[114.47,36.6],
        '临安市':[119.72,30.23],
        '兰州市':[103.73,36.03],
        '沧州市':[116.83,38.33],
        '临沂市':[118.35,35.05],
        '南充市':[106.110698,30.837793],
        '天津市':[117.2,39.13],
        '富阳市':[119.95,30.07],
        '泰安市':[117.13,36.18],
        '诸暨市':[120.23,29.71],
        '郑州市':[113.65,34.76],
        '哈尔滨市':[126.63,45.75],
        '聊城市':[115.97,36.45],
        '芜湖市':[118.38,31.33],
        '唐山市':[118.02,39.63],
        '平顶山市':[113.29,33.75],
        '邢台市':[114.48,37.05],
        '德州市':[116.29,37.45],
        '济宁市':[116.59,35.38],
        '荆州市':[112.239741,30.335165],
        '宜昌市':[111.3,30.7],
        '义乌市':[120.06,29.32],
        '丽水市':[119.92,28.45],
        '洛阳市':[112.44,34.7],
        '秦皇岛市':[119.57,39.95],
        '株洲市':[113.16,27.83],
        '石家庄市':[114.48,38.03],
        '莱芜市':[117.67,36.19],
        '常德市':[111.69,29.05],
        '保定市':[115.48,38.85],
        '湘潭市':[112.91,27.87],
        '金华市':[119.64,29.12],
        '岳阳市':[113.09,29.37],
        '长沙市':[113,28.21],
        '衢州市':[118.88,28.97],
        '廊坊市':[116.7,39.53],
        '菏泽市':[115.480656,35.23375],
        '合肥市':[117.27,31.86],
        '武汉市':[114.31,30.52],
        '大庆市':[125.03,46.58],
        '大兴安岭地区':[121.12,52.15],
        '佳木斯市':[131.15,46.50],
        '喀什地区':[75.57,38.20]
    };

    var planePath = 'path://M1705.06,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705.06,1318.313z';

    //数据转换
    var convertData = function (data) {
        var res = [];
        //离开和到达城市的经纬度
        for (var i = 0; i < data.length; i++) {
            var dataItem = data[i];
            var fromCoord = geoCoordMap[dataItem[0].name];
            var toCoord = geoCoordMap[dataItem[1].name];
            if(typeof(fromCoord)=="undefined"||typeof(toCoord)=="undefined"){
                continue;
            }
            if (fromCoord && toCoord) {
                res.push({
                    fromName: dataItem[0].name,
                    toName: dataItem[1].name,
                    coords: [fromCoord, toCoord]
                });
            }
        }
        return res;
    };
    var convertData1 = function (data) {
        var res = [];
        for (var i = 0; i < data.length; i++) {
            var geoCoord = geoCoordMap[data[i].name];
            if (geoCoord) {
                res.push({
                    name: data[i].name,
                    value: geoCoord.concat(data[i].value)
                });
            }
        }
        return res;
    }
    var data1=[{name: '台州市', value: 140},
        {name: '三亚市', value: 140},
        {name: '大兴安岭地区', value: 140},
        {name: '喀什地区', value: 140},
        {name: '佳木斯市', value: 140},
        {name: '温州市', value: 140}];

    //航线颜色
    var color = ['#a6c84c', '#ffa022', '#46bee9'];
    var series = [];
    var a=["北京",BJData];
    var dataList=[];
    dataList.push(a);
    //航线数据
    for(var i=0;i<dataList.length;i++) {
        var item=dataList[i];
        series.push({
                silent:true,
                name: "城市",
                type: 'lines',
                zlevel: 1,
                coordinateSystem: 'geo',
                //线特效的配置
                effect: {
                    //是否显示
                    show: true,
                    //特效动画时间
                    period: 6,
                    //特效尾迹长度
                    trailLength: 0.7,
                    //特效标记颜色
                    color: '#fff',
                    //特效标记大小
                    symbolSize: 3
                },
                lineStyle: {
                    normal: {
                        color: color[i],
                        width: 0,
                        //边的曲度
                        curveness: 0.2
                    }
                },
                //获取数据列表
                data: convertData(item[1])
            },
            {
                silent:true,
                name: "城市",
                type: 'lines',
                coordinateSystem: 'geo',
                //大的level值会在小的上面
                zlevel: 2,
                //线两端的类型 空 箭头
                symbol: ['none', 'arrow'],
                symbolSize: 10,
                effect: {
                    show: true,
                    period: 6,
                    trailLength: 0,
                    symbol: planePath,
                    symbolSize: 15
                },
                lineStyle: {
                    color: color[i],
                    width: 1,
                    opacity: 0.6,
                    curveness: 0.2
                },
                data: convertData(item[1])
            },
            {
                //带有涟漪特效的散点图
                silent:true,
                name: "城市",
                coordinateSystem: 'geo',
                type: 'effectScatter',
                zlevel: 2,
                //涟漪相关配置
                rippleEffect: {
                    //波纹的绘制方式
                    brushType: 'stroke'
                },
                label: {
                    show: true,
                    position: 'right',
                    formatter: '{b}'
                },
                symbolSize: function (val) {
                    return val[2] / 8;
                },
                //散点大小
                itemStyle: {
                    color: color[i]
                },
                data: item[1].map(function (dataItem) {
                    return {
                        name: "",
                        value: geoCoordMap[dataItem[1].name].concat([dataItem[1].value.toString()])
                    };
                })
            });
    };
    //单点测试
    series.push({
            itemStyle:{
                color:"#a6c84c"
            },
            name: '城市',
            type: 'effectScatter',
            coordinateSystem: 'geo',
            data: convertData1(data1.sort(function (a, b) {
                return b.value - a.value;
            }).slice(0, 6)),
            symbolSize: function (val) {
                return val[2] / 10;
            },
            encode: {
                value: 2
            },
            showEffectOn: 'render',
            rippleEffect: {
                brushType: 'stroke'
            },
            hoverAnimation: true,
            label: {
                formatter: '{b}',
                position: 'right',
                show: true
            },
            itemStyle: {
                shadowBlur: 10,
                shadowColor: '#333'
            },
            zlevel: 10
        });
    //测试
    var startPoint = {
        x: 104.114129,
        y: 37.550339
    };
    var bmap = {
        center: [startPoint.x, startPoint.y],
        zoom: 5,
        roam: true,
        mapStyle: {
            styleJson: [{
                "featureType": "water",
                "elementType": "all",
                "stylers": {
                    "color": "#044161"
                }
            }, {
                "featureType": "land",
                "elementType": "all",
                "stylers": {
                    "color": "#004981"
                }
            }, {
                "featureType": "boundary",
                "elementType": "geometry",
                "stylers": {
                    "color": "#064f85"
                }
            }, {
                "featureType": "railway",
                "elementType": "all",
                "stylers": {
                    "visibility": "off"
                }
            }, {
                "featureType": "highway",
                "elementType": "geometry",
                "stylers": {
                    "color": "#004981"
                }
            }, {
                "featureType": "highway",
                "elementType": "geometry.fill",
                "stylers": {
                    "color": "#005b96",
                    "lightness": 1
                }
            }, {
                "featureType": "highway",
                "elementType": "labels",
                "stylers": {
                    "visibility": "off"
                }
            }, {
                "featureType": "arterial",
                "elementType": "geometry",
                "stylers": {
                    "color": "#004981"
                }
            }, {
                "featureType": "arterial",
                "elementType": "geometry.fill",
                "stylers": {
                    "color": "#00508b"
                }
            }, {
                "featureType": "poi",
                "elementType": "all",
                "stylers": {
                    "visibility": "off"
                }
            }, {
                "featureType": "green",
                "elementType": "all",
                "stylers": {
                    "color": "#056197",
                    "visibility": "off"
                }
            }, {
                "featureType": "subway",
                "elementType": "all",
                "stylers": {
                    "visibility": "off"
                }
            }, {
                "featureType": "manmade",
                "elementType": "all",
                "stylers": {
                    "visibility": "off"
                }
            }, {
                "featureType": "local",
                "elementType": "all",
                "stylers": {
                    "visibility": "off"
                }
            }, {
                "featureType": "arterial",
                "elementType": "labels",
                "stylers": {
                    "visibility": "off"
                }
            }, {
                "featureType": "boundary",
                "elementType": "geometry.fill",
                "stylers": {
                    "color": "#029fd4"
                }
            }, {
                "featureType": "building",
                "elementType": "all",
                "stylers": {
                    "color": "#1a5787"
                }
            }, {
                "featureType": "label",
                "elementType": "all",
                "stylers": {
                    "visibility": "off"
                }
            }]
        }
    }
    option = {
        //背景颜色
        backgroundColor: '#404a59',
        //标记点的颜色
        color: ['#a6c84c'],
        //标题
        title: {
            text: '点亮的城市',
            subtext: '去过的地方',
            left: 'center',
            textStyle: {
                color: '#fff'
            }
        },
        tooltip : {
            trigger: 'item'
        },
        legend: {
            orient: 'vertical',
            top: 'bottom',
            left: 'right',
            textStyle: {
                color: '#fff'
            },
            selectedMode: 'single'
        },
        geo: {
            map:"china",
            //是否显示坐标轴
            show:true,
            //是否显示便签
            label: {
                show: false
            },
            //鼠标缩放和平移漫游
            roam: true,
            itemStyle: {
                areaColor: '#323c48',
                borderColor: '#404a59'
            },

            emphasis: {
                label: {
                    show: true
                },
                itemStyle: {
                    areaColor: '#2a333d'
                }
            }
        },
        bmap: bmap,
        series :series
    };
    migrationMapChart.on('click',function (param){
        if(param["componentType"]=="geo"){
            return;
        }
        var cityname=param["name"];
        var ctrl= document.querySelector('[ng-controller=photoCtr]');
        var $scope = angular.element(ctrl).scope();
        $scope.cityname=cityname;
        $scope.$apply();
        console.log(cityname);


    });
    migrationMapChart.on('mouseover',function (param){
        if(param["componentType"]=="geo"){
            return;
        }
        var cityname=param["name"];
        var ctrl= document.querySelector('[ng-controller=photoCtr]');
        var $scope = angular.element(ctrl).scope();
        $scope.cityname=cityname;
        $scope.$apply();
        console.log(cityname);


    });
    migrationMapChart.setOption(option)
</script>


<script src="/ace/assets/js/jquery-1.11.3.min.js"></script>
<![endif]-->
<script type="text/javascript">
    if('ontouchstart' in document.documentElement) document.write("<script src='/ace/assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
</script>
<script src="/ace/assets/js/bootstrap.min.js"></script>

<!-- page specific plugin scripts -->

<!--[if lte IE 8]>
<script src="/ace/assets/js/excanvas.min.js"></script>
<![endif]-->
<script src="/ace/assets/js/jquery-ui.custom.min.js"></script>
<script src="/ace/assets/js/jquery.ui.touch-punch.min.js"></script>
<script src="/ace/assets/js/jquery.easypiechart.min.js"></script>
<script src="/ace/assets/js/jquery.sparkline.index.min.js"></script>
<script src="/ace/assets/js/jquery.flot.min.js"></script>
<script src="/ace/assets/js/jquery.flot.pie.min.js"></script>
<script src="/ace/assets/js/jquery.flot.resize.min.js"></script>

<!-- ace scripts -->
<script src="/ace/assets/js/ace-elements.min.js"></script>
<script src="/ace/assets/js/ace.min.js"></script>

<!-- inline scripts related to this page -->
<script type="text/javascript">
    jQuery(function($) {
        $('.easy-pie-chart.percentage').each(function(){
            var $box = $(this).closest('.infobox');
            var barColor = $(this).data('color') || (!$box.hasClass('infobox-dark') ? $box.css('color') : 'rgba(255,255,255,0.95)');
            var trackColor = barColor == 'rgba(255,255,255,0.95)' ? 'rgba(255,255,255,0.25)' : '#E2E2E2';
            var size = parseInt($(this).data('size')) || 50;
            $(this).easyPieChart({
                barColor: barColor,
                trackColor: trackColor,
                scaleColor: false,
                lineCap: 'butt',
                lineWidth: parseInt(size/10),
                animate: ace.vars['old_ie'] ? false : 1000,
                size: size
            });
        })

        $('.sparkline').each(function(){
            var $box = $(this).closest('.infobox');
            var barColor = !$box.hasClass('infobox-dark') ? $box.css('color') : '#FFF';
            $(this).sparkline('html',
                {
                    tagValuesAttribute:'data-values',
                    type: 'bar',
                    barColor: barColor ,
                    chartRangeMin:$(this).data('min') || 0
                });
        });


        //flot chart resize plugin, somehow manipulates default browser resize event to optimize it!
        //but sometimes it brings up errors with normal resize event handlers
        $.resize.throttleWindow = false;

        var placeholder = $('#piechart-placeholder').css({'width':'90%' , 'min-height':'150px'});
        var data = [
            { label: "social networks",  data: 38.7, color: "#68BC31"},
            { label: "search engines",  data: 24.5, color: "#2091CF"},
            { label: "ad campaigns",  data: 8.2, color: "#AF4E96"},
            { label: "direct traffic",  data: 18.6, color: "#DA5430"},
            { label: "other",  data: 10, color: "#FEE074"}
        ]
        function drawPieChart(placeholder, data, position) {
            $.plot(placeholder, data, {
                series: {
                    pie: {
                        show: true,
                        tilt:0.8,
                        highlight: {
                            opacity: 0.25
                        },
                        stroke: {
                            color: '#fff',
                            width: 2
                        },
                        startAngle: 2
                    }
                },
                legend: {
                    show: true,
                    position: position || "ne",
                    labelBoxBorderColor: null,
                    margin:[-30,15]
                }
                ,
                grid: {
                    hoverable: true,
                    clickable: true
                }
            })
        }
        drawPieChart(placeholder, data);

        /**
         we saved the drawing function and the data to redraw with different position later when switching to RTL mode dynamically
         so that's not needed actually.
         */
        placeholder.data('chart', data);
        placeholder.data('draw', drawPieChart);


        //pie chart tooltip example
        var $tooltip = $("<div class='tooltip top in'><div class='tooltip-inner'></div></div>").hide().appendTo('body');
        var previousPoint = null;

        placeholder.on('plothover', function (event, pos, item) {
            if(item) {
                if (previousPoint != item.seriesIndex) {
                    previousPoint = item.seriesIndex;
                    var tip = item.series['label'] + " : " + item.series['percent']+'%';
                    $tooltip.show().children(0).text(tip);
                }
                $tooltip.css({top:pos.pageY + 10, left:pos.pageX + 10});
            } else {
                $tooltip.hide();
                previousPoint = null;
            }

        });

        /////////////////////////////////////
        $(document).one('ajaxloadstart.page', function(e) {
            $tooltip.remove();
        });




        var d1 = [];
        for (var i = 0; i < Math.PI * 2; i += 0.5) {
            d1.push([i, Math.sin(i)]);
        }

        var d2 = [];
        for (var i = 0; i < Math.PI * 2; i += 0.5) {
            d2.push([i, Math.cos(i)]);
        }

        var d3 = [];
        for (var i = 0; i < Math.PI * 2; i += 0.2) {
            d3.push([i, Math.tan(i)]);
        }


        var sales_charts = $('#sales-charts').css({'width':'100%' , 'height':'220px'});
        $.plot("#sales-charts", [
            { label: "Domains", data: d1 },
            { label: "Hosting", data: d2 },
            { label: "Services", data: d3 }
        ], {
            hoverable: true,
            shadowSize: 0,
            series: {
                lines: { show: true },
                points: { show: true }
            },
            xaxis: {
                tickLength: 0
            },
            yaxis: {
                ticks: 10,
                min: -2,
                max: 2,
                tickDecimals: 3
            },
            grid: {
                backgroundColor: { colors: [ "#fff", "#fff" ] },
                borderWidth: 1,
                borderColor:'#555'
            }
        });


        $('#recent-box [data-rel="tooltip"]').tooltip({placement: tooltip_placement});
        function tooltip_placement(context, source) {
            var $source = $(source);
            var $parent = $source.closest('.tab-content')
            var off1 = $parent.offset();
            var w1 = $parent.width();

            var off2 = $source.offset();
            //var w2 = $source.width();

            if( parseInt(off2.left) < parseInt(off1.left) + parseInt(w1 / 2) ) return 'right';
            return 'left';
        }


        $('.dialogs,.comments').ace_scroll({
            size: 300
        });


        //Android's default browser somehow is confused when tapping on label which will lead to dragging the task
        //so disable dragging when clicking on label
        var agent = navigator.userAgent.toLowerCase();
        if(ace.vars['touch'] && ace.vars['android']) {
            $('#tasks').on('touchstart', function(e){
                var li = $(e.target).closest('#tasks li');
                if(li.length == 0)return;
                var label = li.find('label.inline').get(0);
                if(label == e.target || $.contains(label, e.target)) e.stopImmediatePropagation() ;
            });
        }

        $('#tasks').sortable({
                opacity:0.8,
                revert:true,
                forceHelperSize:true,
                placeholder: 'draggable-placeholder',
                forcePlaceholderSize:true,
                tolerance:'pointer',
                stop: function( event, ui ) {
                    //just for Chrome!!!! so that dropdowns on items don't appear below other items after being moved
                    $(ui.item).css('z-index', 'auto');
                }
            }
        );
        $('#tasks').disableSelection();
        $('#tasks input:checkbox').removeAttr('checked').on('click', function(){
            if(this.checked) $(this).closest('li').addClass('selected');
            else $(this).closest('li').removeClass('selected');
        });


        //show the dropdowns on top or bottom depending on window height and menu position
        $('#task-tab .dropdown-hover').on('mouseenter', function(e) {
            var offset = $(this).offset();

            var $w = $(window)
            if (offset.top > $w.scrollTop() + $w.innerHeight() - 100)
                $(this).addClass('dropup');
            else $(this).removeClass('dropup');
        });

    })
</script>
</body>
</html>
